<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="/css/user/loginInfo.css">

</head>
<body>
<div class="container">
    <div class="left-side">
        <div class="logo">WAY</div>
    </div>
    <div class="right-side">
        <div class="right-panel">
            <h1>ì–´ë–¤ ë¶„ì•¼ì— ê´€ì‹¬ì´ ìˆë‚˜ìš”?</h1>
            <p>
                ê´€ì‹¬ì‚¬ íƒœê·¸ë¥¼ ì¶”ê°€í•´ì£¼ì„¸ìš”!<br />íƒœê·¸ì™€ ê´€ë ¨ëœ ìœ ì €ë¥¼ ì¶”ì²œí•´ë“œë¦½ë‹ˆë‹¤
                ğŸ˜†
            </p>
            <input type="text" placeholder="íƒœê·¸ ê²€ìƒ‰" id="tagInput" />
            <button class="next-button" id="viewAll">ì „ì²´ë³´ê¸°</button>
            <div class="selected-tags">

            </div>
            <div class="available-tags">

            </div>
            <button class="next-button" id="finishBtn">ì™„ë£Œ</button>
        </div>
    </div>
</div>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function () {
        viewAll();
        $('#viewAll').click(function(){
            viewAll();
        });
        let availableContainer = $(".available-tags");
        let selectedContainer = $(".selected-tags");
        //ì „ì²´ íƒœê·¸ ë¶ˆëŸ¬ì˜¤ê¸°
        function viewAll(){
            $.ajax({
                url:'/interest/all',
                method:'GET',
                success:function(result){
                    availableContainer.empty();
                    $.each(result, function(index, tag) {
                        let tagElement = $("<div>").text(tag.name).appendTo(availableContainer);


                        tagElement.on("click", function () {
                            if (!isTagAlreadySelected(tag.name)) {
                                $(this).appendTo(selectedContainer);
                            }
                        });
                    });
                },
                error:function (err){
                    console.log(err);
                }
            })
        }
        //ì´ë¯¸ì„ íƒí–ˆëŠ”ì§€ ì²´í¬
        function isTagAlreadySelected(tagName) {
            let isSelected = false;
            selectedContainer.find("div").each(function() {
                if ($(this).text() === tagName) {
                    isSelected = true;
                }
            });
            return isSelected;
        }

        //ê²€ìƒ‰ì— ë”°ë¼ ë°‘ ìš”ì†Œ ë°”ë€Œê²Œ
        $('#tagInput').on('input',function(){
            let keyword = $('#tagInput').val();
            $.ajax({
                url:'/interest/search?keyword='+keyword,
                method: 'GET',
                success:function (result){
                    console.log(result);
                    availableContainer.empty();
                    $.each(result, function(index, tag) {
                        console.log(tag);
                        let tagElement = $("<div>").text(tag).appendTo(availableContainer);


                        tagElement.on("click", function () {
                            if (!isTagAlreadySelected(tag.name)) {
                                $(this).appendTo(selectedContainer);
                            }
                        });
                    });
                },error:function(err){
                    console.log(err);
                }
            })
        })

        //ì™„ë£Œë²„íŠ¼ í´ë¦­
        $('#finishBtn').click(function(){
            selectedContainer = $(".selected-tags");
            let value = [];
            selectedContainer.find("div").each(function() {
                value.push($(this).text());
            });
            $.ajax({
                url:'/user/addInterests',
                method:'POST',
                contentType:'application/json',
                data: JSON.stringify(value),
                success:function(result){
                    if(result!=='success'){
                        alert('ê´€ì‹¬ ì„¤ì • ì˜¤ë¥˜');
                    }
                    window.location.href='/main'

                },
                error:function(err){
                    console.log(err);
                }
            })
        })
    });
</script>
</body>
</html>